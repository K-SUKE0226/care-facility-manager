<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URLä¸€æ‹¬å‡¦ç†ãƒ„ãƒ¼ãƒ« - ä»‹è­·æ–½è¨­æƒ…å ±æŠ½å‡º</title>
    <style>
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c5282;
            text-align: center;
            border-bottom: 3px solid #3182ce;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        .input-section {
            background-color: #f8fafc;
            border: 2px solid #3182ce;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        #urlInput {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
            line-height: 1.5;
            resize: vertical;
            box-sizing: border-box;
        }
        .btn {
            background: linear-gradient(135deg, #3182ce, #2c5282);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 15px;
            box-shadow: 0 4px 12px rgba(49, 130, 206, 0.3);
        }
        .btn:hover {
            background: linear-gradient(135deg, #2c5282, #2a4a7a);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .clear-btn {
            background-color: #ed8936;
            box-shadow: 0 4px 12px rgba(237, 137, 54, 0.3);
        }
        .download-btn {
            background-color: #38a169;
            box-shadow: 0 4px 12px rgba(56, 161, 105, 0.3);
        }
        .progress-section {
            display: none;
            background-color: #fffaf0;
            border: 2px solid #ed8936;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #38a169, #48bb78);
            transition: width 0.3s ease;
            width: 0%;
        }
        .progress-text {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            text-align: center;
            margin-bottom: 15px;
        }
        .log {
            max-height: 200px;
            overflow-y: auto;
            background-color: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        .results-section {
            display: none;
            background-color: #f0fff4;
            border: 2px solid #38a169;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-item {
            text-align: center;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            flex: 1;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #3182ce;
            display: block;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        .info-note {
            background-color: #e6fffa;
            border-left: 4px solid #319795;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”— æ–½è¨­URLæŠ½å‡ºãƒ„ãƒ¼ãƒ«</h1>
        
        <div class="info-note">
            <strong>ã“ã®ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦:</strong><br>
            ä»‹è­·æ–½è¨­é‹å–¶ä¼šç¤¾ã®æ–½è¨­ä¸€è¦§ãƒšãƒ¼ã‚¸ã‹ã‚‰ã€å€‹åˆ¥æ–½è¨­ã®URLã‚’è‡ªå‹•æŠ½å‡ºã—ã¾ã™ã€‚<br>
            æŠ½å‡ºã—ãŸURLã¯ã€æ–½è¨­ç®¡ç†ã‚·ãƒ¼ãƒˆã§ã®ä¸€æ‹¬ãƒ‡ãƒ¼ã‚¿å–å¾—ã«ä½¿ç”¨ã§ãã¾ã™ã€‚
        </div>
        
        <div class="input-section">
            <h3>ğŸŒ æ–½è¨­ä¸€è¦§ãƒšãƒ¼ã‚¸ã®URL</h3>
            <p>æ–½è¨­ä¸€è¦§ãŒæ²è¼‰ã•ã‚Œã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:</p>
            <textarea id="urlInput" placeholder="ä¾‹:
https://noah-garden.com/noah/search
https://www.minnannokaigo.com/search/hokkaido/sapporo/
https://kaigo.homes.co.jp/s/list/ad11=1/ct=5/area2=102/
..."></textarea>
            <div style="margin-top: 15px;">
                <button onclick="startExtraction()" class="btn" id="extractBtn">
                    ğŸ” URLæŠ½å‡ºé–‹å§‹
                </button>
                <button onclick="clearInput()" class="clear-btn btn">
                    ğŸ—‘ï¸ ã‚¯ãƒªã‚¢
                </button>
            </div>
        </div>
        
        <div id="progressSection" class="progress-section">
            <h3>âš¡ å‡¦ç†çŠ¶æ³</h3>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <div id="progressText" class="progress-text">æº–å‚™ä¸­...</div>
            <div id="logContainer" class="log"></div>
        </div>
        
        <div id="resultsSection" class="results-section">
            <h3>ğŸ“‹ æŠ½å‡ºçµæœ</h3>
            <div class="stats">
                <div class="stat-item">
                    <span id="totalUrls" class="stat-number">0</span>
                    <span class="stat-label">æŠ½å‡ºURLæ•°</span>
                </div>
                <div class="stat-item">
                    <span id="processedSites" class="stat-number">0</span>
                    <span class="stat-label">å‡¦ç†ã‚µã‚¤ãƒˆæ•°</span>
                </div>
                <div class="stat-item">
                    <span id="uniqueUrls" class="stat-number">0</span>
                    <span class="stat-label">ãƒ¦ãƒ‹ãƒ¼ã‚¯URLæ•°</span>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <button onclick="copyUrlsToClipboard()" class="download-btn btn" id="copyBtn">
                    ğŸ“‹ URLã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
                </button>
                <button onclick="downloadUrlList()" class="btn">
                    ğŸ“¥ URLãƒªã‚¹ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                </button>
                <button onclick="resetAll()" class="clear-btn btn">
                    ğŸ”„ ãƒªã‚»ãƒƒãƒˆ
                </button>
            </div>
            
            <div class="url-list" id="urlList" style="max-height: 300px; overflow-y: auto; background-color: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 15px; margin: 15px 0;"></div>
        </div>
    </div>

    <script>
        let extractedUrls = [];
        
        // URLæŠ½å‡ºé–‹å§‹
        async function startExtraction() {
            const urlInput = document.getElementById('urlInput').value.trim();
            const extractBtn = document.getElementById('extractBtn');
            
            if (!urlInput) {
                alert('URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            const urls = urlInput.split('\\n')
                .map(url => url.trim())
                .filter(url => url.length > 0 && (url.startsWith('http://') || url.startsWith('https://')));
            
            if (urls.length === 0) {
                alert('æœ‰åŠ¹ãªURLï¼ˆhttp://ã¾ãŸã¯https://ã§å§‹ã¾ã‚‹ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            // åˆæœŸåŒ–
            extractedUrls = [];
            extractBtn.disabled = true;
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const logContainer = document.getElementById('logContainer');
            
            progressText.textContent = `å‡¦ç†é–‹å§‹: ${urls.length}ä»¶ã®URLã‚’å‡¦ç†ã—ã¾ã™...`;
            logContainer.innerHTML = '';
            
            addLog('ğŸš€ ä¸€æ‹¬å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã—ãŸ');
            addLog(`ğŸ“‹ å‡¦ç†å¯¾è±¡: ${urls.length}ä»¶ã®URL`);
            
            try {
                for (let i = 0; i < urls.length; i++) {
                    const url = urls[i];
                    const urlType = detectUrlType(url);
                    
                    addLog(`ğŸ” [${i + 1}/${urls.length}] ${urlType.name}: ${url}`);
                    progressText.textContent = `å‡¦ç†ä¸­ (${i + 1}/${urls.length}): ${url}`;
                    progressFill.style.width = `${((i + 1) / urls.length) * 100}%`;
                    
                    try {
                        const extractedData = await extractInfoFromUrl(url, urlType);
                        
                        if (extractedData && extractedData.length > 0) {
                            processedData = processedData.concat(extractedData);
                            addLog(`âœ… æˆåŠŸ: ${extractedData.length}ä»¶ã®æ–½è¨­æƒ…å ±ã‚’å–å¾—`);
                        } else {
                            addLog(`âš ï¸ æƒ…å ±å–å¾—ãªã—: æœ‰åŠ¹ãªæ–½è¨­æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ`);
                        }
                        
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                    } catch (error) {
                        addLog(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    }
                }
                
                progressText.textContent = `å®Œäº†: ${processedData.length}ä»¶ã®æ–½è¨­æƒ…å ±ã‚’å–å¾—ã—ã¾ã—ãŸ`;
                addLog(`ğŸ‰ å‡¦ç†å®Œäº†: åˆè¨ˆ${processedData.length}ä»¶ã®æ–½è¨­æƒ…å ±ã‚’å–å¾—`);
                
                if (processedData.length > 0) {
                    showResults();
                } else {
                    addLog('âš ï¸ å–å¾—ã§ããŸæ–½è¨­æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                }
                
            } catch (error) {
                progressText.textContent = 'å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
                addLog(`ğŸ’¥ è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            } finally {
                processBtn.disabled = false;
            }
        }
        
        // URLç¨®åˆ¥åˆ¤å®š
        function detectUrlType(url) {
            const urlLower = url.toLowerCase();
            
            if (urlLower.includes('homes.co.jp')) {
                return { type: 'HOMES', name: 'ãƒ©ã‚¤ãƒ•ãƒ«ãƒ›ãƒ¼ãƒ ã‚º' };
            } else if (urlLower.includes('minnannokaigo.com')) {
                return { type: 'MINNANO', name: 'ã¿ã‚“ãªã®ä»‹è­·' };
            } else if (urlLower.includes('.lg.jp') || urlLower.includes('.city.') || urlLower.includes('.pref.')) {
                return { type: 'GOVERNMENT', name: 'è‡ªæ²»ä½“ã‚µã‚¤ãƒˆ' };
            } else if (urlLower.includes('kaigo') || urlLower.includes('nursing') || urlLower.includes('care')) {
                return { type: 'CARE_SITE', name: 'ä»‹è­·é–¢é€£ã‚µã‚¤ãƒˆ' };
            } else {
                return { type: 'INDIVIDUAL', name: 'å€‹åˆ¥æ–½è¨­ã‚µã‚¤ãƒˆ' };
            }
        }
        
        // å®Ÿéš›ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚µãƒ¼ãƒãƒ¼ã¨é€£æº
        async function extractInfoFromUrl(url, urlType) {
            try {
                addLog(`ğŸŒ ${url} ã«ã‚¢ã‚¯ã‚»ã‚¹ä¸­...`);
                
                const response = await fetch('http://localhost:5000/api/scrape', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        urls: [url]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.facilities) {
                    addLog(`âœ… ${data.facilities.length}ä»¶ã®æ–½è¨­æƒ…å ±ã‚’å–å¾—`);
                    return data.facilities;
                } else {
                    throw new Error(data.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼');
                }
                
            } catch (error) {
                addLog(`âŒ ${url} ã®å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚µãƒ¼ãƒãƒ¼ãŒåˆ©ç”¨ã§ããªã„å ´åˆã¯ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
                addLog(`ğŸ”„ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§ä»£æ›¿å‡¦ç†ä¸­...`);
                return await fallbackExtractInfo(url, urlType);
            }
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        async function fallbackExtractInfo(url, urlType) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const facilityCount = Math.floor(Math.random() * 3) + 1;
                    const results = [];
                    
                    for (let i = 0; i < facilityCount; i++) {
                        const sampleNames = [
                            'æœ­å¹Œä¸­å¤®ä»‹è­·ãƒ›ãƒ¼ãƒ ', 'åŒ—åŒºã‚„ã¾ã–ãã‚‰ãƒ›ãƒ¼ãƒ ', 'æ‰‹ç¨²ã¿ã©ã‚Šã®é¢¨',
                            'è±Šå¹³ã‚°ãƒ«ãƒ¼ãƒ—ãƒ›ãƒ¼ãƒ ', 'ç™½çŸ³ã‚±ã‚¢ã‚»ãƒ³ã‚¿ãƒ¼'
                        ];
                        
                        const sampleAreas = ['ä¸­å¤®åŒº', 'åŒ—åŒº', 'æ±åŒº', 'ç™½çŸ³åŒº', 'è±Šå¹³åŒº'];
                        const sampleAvailability = ['ç©ºãã‚ã‚Š', 'ç©ºãåƒ…ã‹', 'æº€å®¤', 'è¦ç¢ºèª'];
                        const sampleFees = ['12ä¸‡å††ã€œ18ä¸‡å††', '10ä¸‡å††ã€œ15ä¸‡å††', '15ä¸‡å††ã€œ22ä¸‡å††'];
                        
                        results.push({
                            name: sampleNames[Math.floor(Math.random() * sampleNames.length)] + (facilityCount > 1 ? ` ${i + 1}` : '') + ' [ãƒ†ã‚¹ãƒˆ]',
                            address: `æœ­å¹Œå¸‚${sampleAreas[Math.floor(Math.random() * sampleAreas.length)]}â—‹â—‹${Math.floor(Math.random() * 30) + 1}ä¸ç›®${Math.floor(Math.random() * 20) + 1}-${Math.floor(Math.random() * 30) + 1}`,
                            area: sampleAreas[Math.floor(Math.random() * sampleAreas.length)],
                            phone: `011-${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`,
                            websiteUrl: url,
                            careLevel: 'è¦ä»‹è­·1,è¦ä»‹è­·2,è¦ä»‹è­·3,è¦ä»‹è­·4,è¦ä»‹è­·5',
                            monthlyFee: sampleFees[Math.floor(Math.random() * sampleFees.length)],
                            medicalCare: 'èƒƒã‚ã†ã€ãŸã‚“å¸å¼•ã€ã‚¤ãƒ³ã‚¹ãƒªãƒ³æ³¨å°„å¯¾å¿œ',
                            features: '24æ™‚é–“çœ‹è­·å¸«å¸¸é§ã€ãƒªãƒãƒ“ãƒªå……å®Ÿ',
                            availability: sampleAvailability[Math.floor(Math.random() * sampleAvailability.length)],
                            reliabilityLevel: 'medium',
                            lastConfirmed: new Date().toISOString().split('T')[0],
                            confirmationMethod: 'web',
                            notes: `${urlType.name}ã‹ã‚‰è‡ªå‹•å–å¾—ï¼ˆãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼‰`,
                            reviews: `[ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ ${new Date().toLocaleDateString('ja-JP')}] ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šæ™‚ã®ä»£æ›¿ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚`,
                            sourceUrl: url,
                            sourceType: urlType.name + 'ï¼ˆãƒ†ã‚¹ãƒˆï¼‰'
                        });
                    }
                    
                    resolve(results);
                }, 1000);
            });
        }
        
        // ãƒ­ã‚°è¿½åŠ 
        function addLog(message) {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // çµæœè¡¨ç¤º
        function showResults() {
            const totalCount = processedData.length;
            const areaStats = {};
            let availableCount = 0;
            
            processedData.forEach(facility => {
                areaStats[facility.area] = (areaStats[facility.area] || 0) + 1;
                if (facility.availability === 'ç©ºãã‚ã‚Š') {
                    availableCount++;
                }
            });
            
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('areaCount').textContent = Object.keys(areaStats).length;
            document.getElementById('availableCount').textContent = availableCount;
            
            document.getElementById('resultsSection').style.display = 'block';
        }
        
        // CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆUTF-8ç‰ˆã®ã¿ï¼‰
        function downloadCSV() {
            if (processedData.length === 0) {
                alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
                return;
            }
            
            downloadUTF8CSV();
        }
        
        function downloadUTF8CSV() {
            const headers = [
                'æ–½è¨­å', 'ã‚¨ãƒªã‚¢', 'ä½æ‰€', 'é›»è©±ç•ªå·', 'ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸URL',
                'ç©ºãçŠ¶æ³', 'ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«', 'æœˆé¡æ–™é‡‘', 'å—å…¥å¯èƒ½è¦ä»‹è­·åº¦',
                'åŒ»ç™‚ã‚±ã‚¢', 'æ–½è¨­ç‰¹å¾´', 'ç‰¹è¨˜äº‹é …', 'å£ã‚³ãƒŸæƒ…å ±',
                'æœ€çµ‚ç¢ºèªæ—¥', 'ç¢ºèªæ–¹æ³•', 'å–å¾—å…ƒURL', 'å–å¾—å…ƒã‚µã‚¤ãƒˆ'
            ];
            
            let csvContent = headers.join(',') + '\n';
            
            processedData.forEach(facility => {
                const row = [
                    escapeCSVField(facility.name),
                    escapeCSVField(facility.area),
                    escapeCSVField(facility.address),
                    escapeCSVField(facility.phone),
                    escapeCSVField(facility.websiteUrl),
                    escapeCSVField(facility.availability),
                    escapeCSVField(facility.reliabilityLevel),
                    escapeCSVField(facility.monthlyFee),
                    escapeCSVField(facility.careLevel),
                    escapeCSVField(facility.medicalCare),
                    escapeCSVField(facility.features),
                    escapeCSVField(facility.notes),
                    escapeCSVField(facility.reviews),
                    escapeCSVField(facility.lastConfirmed),
                    escapeCSVField(facility.confirmationMethod),
                    escapeCSVField(facility.sourceUrl),
                    escapeCSVField(facility.sourceType)
                ];
                csvContent += row.join(',') + '\n';
            });
            
            // UTF-8 BOMã‚’è¿½åŠ 
            const BOM = '\uFEFF';
            const csvWithBOM = BOM + csvContent;
            
            const blob = new Blob([csvWithBOM], { type: 'text/csv;charset=utf-8;' });
            downloadFile(blob, `ä»‹è­·æ–½è¨­ä¸€æ‹¬å–å¾—_${new Date().toISOString().split('T')[0]}.csv`);
            
            alert('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼\\n\\nUTF-8å½¢å¼ã§ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚\\nã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã§ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚');
        }
        
        function escapeCSVField(field) {
            if (field === null || field === undefined) {
                return '""';
            }
            let str = String(field);
            // ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
            str = str.replace(/"/g, '""');
            // ã‚«ãƒ³ãƒã€æ”¹è¡Œã€ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆãŒå«ã¾ã‚Œã‚‹å ´åˆã¯ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã‚€
            if (str.includes(',') || str.includes('\n') || str.includes('"')) {
                str = `"${str}"`;
            } else {
                str = `"${str}"`;
            }
            return str;
        }
        
        function downloadFile(blob, filename) {
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
        
        // å…¥åŠ›ã‚¯ãƒªã‚¢
        function clearInput() {
            document.getElementById('urlInput').value = '';
        }
        
        // å…¨ãƒªã‚»ãƒƒãƒˆ
        function resetAll() {
            clearInput();
            processedData = [];
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'none';
        }
    </script>
</body>
</html>