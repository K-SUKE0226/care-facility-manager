<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆãƒ‡ãƒãƒƒã‚°</title>
</head>
<body style="padding: 20px; font-family: Arial, sans-serif;">
    <h1>ğŸ” ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ã®ãƒ‡ãƒãƒƒã‚°</h1>
    
    <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 20px 0;">
        <h2>æ‰‹å‹•ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testSwitchPageManual()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px;">
            switchPageManual('bulk') ã‚’å®Ÿè¡Œ
        </button>
        <button onclick="testConsoleAccess()" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px;">
            ã‚³ãƒ³ã‚½ãƒ¼ãƒ«é–¢æ•°ç¢ºèª
        </button>
        <button onclick="testDirectBulkPageShow()" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px;">
            ç›´æ¥bulkPageè¡¨ç¤º
        </button>
    </div>
    
    <div style="background-color: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 5px; margin: 20px 0;">
        <h2>ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã¨ã®é•ã„ãƒã‚§ãƒƒã‚¯</h2>
        <button onclick="checkMainAppDifferences()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px;">
            ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã®çŠ¶æ³ã‚’ç¢ºèª
        </button>
        <div id="differences" style="margin-top: 10px; font-family: monospace; font-size: 12px; background: #f8f9fa; padding: 10px; border-radius: 3px; max-height: 300px; overflow-y: auto;">
            çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...
        </div>
    </div>
    
    <div style="background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 5px; margin: 20px 0;">
        <h2>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–</h2>
        <button onclick="startMonitoring()" style="padding: 10px 20px; background: #17a2b8; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px;">
            ç›£è¦–é–‹å§‹
        </button>
        <button onclick="stopMonitoring()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px;">
            ç›£è¦–åœæ­¢
        </button>
        <div id="monitoring" style="margin-top: 10px; font-family: monospace; font-size: 11px; background: #212529; color: #ffffff; padding: 10px; border-radius: 3px; max-height: 200px; overflow-y: auto;">
            ç›£è¦–ãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...
        </div>
    </div>

    <script>
        let monitoringInterval = null;
        
        function addLog(containerId, message) {
            const container = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            container.innerHTML += `[${timestamp}] ${message}<br>`;
            container.scrollTop = container.scrollHeight;
            console.log(message);
        }

        function testSwitchPageManual() {
            addLog('differences', '=== switchPageManual ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’å–å¾—ã—ã‚ˆã†ã¨ã™ã‚‹
            try {
                // æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚’é–‹ã
                const mainApp = window.open('http://localhost:8000', 'mainApp');
                
                setTimeout(() => {
                    try {
                        // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã®switchPageManualé–¢æ•°ã‚’å‘¼ã³å‡ºã™
                        if (mainApp.switchPageManual) {
                            addLog('differences', 'switchPageManualé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ');
                            mainApp.switchPageManual('bulk');
                            addLog('differences', 'switchPageManual("bulk")ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ');
                        } else {
                            addLog('differences', 'ERROR: switchPageManualé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                        }
                        
                        // URLå…¥åŠ›æ¬„ã®çŠ¶æ…‹ç¢ºèª
                        const urlInput = mainApp.document.getElementById('urlInput');
                        if (urlInput) {
                            const style = mainApp.getComputedStyle(urlInput);
                            const rect = urlInput.getBoundingClientRect();
                            addLog('differences', `URLå…¥åŠ›æ¬„ã®çŠ¶æ…‹: display=${style.display}, visibility=${style.visibility}`);
                            addLog('differences', `URLå…¥åŠ›æ¬„ã®ä½ç½®: x=${rect.left}, y=${rect.top}, w=${rect.width}, h=${rect.height}`);
                        } else {
                            addLog('differences', 'ERROR: URLå…¥åŠ›æ¬„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                        }
                    } catch (e) {
                        addLog('differences', `CORS/ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼: ${e.message}`);
                        addLog('differences', 'ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã«ç›´æ¥F12ã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ã„ã¦ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:');
                        addLog('differences', 'switchPageManual("bulk")');
                    }
                }, 2000);
                
            } catch (e) {
                addLog('differences', `ã‚¨ãƒ©ãƒ¼: ${e.message}`);
            }
        }

        function testConsoleAccess() {
            addLog('differences', '=== ã‚³ãƒ³ã‚½ãƒ¼ãƒ«é–¢æ•°ç¢ºèª ===');
            addLog('differences', 'ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª(localhost:8000)ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:');
            addLog('differences', '1. typeof switchPageManual');
            addLog('differences', '2. typeof switchPage');
            addLog('differences', '3. document.getElementById("bulkPage")');
            addLog('differences', '4. document.getElementById("urlInput")');
            addLog('differences', '5. switchPageManual("bulk")');
            addLog('differences', '6. document.getElementById("urlInput").getBoundingClientRect()');
        }

        function testDirectBulkPageShow() {
            addLog('differences', '=== ç›´æ¥è¡¨ç¤ºãƒ†ã‚¹ãƒˆ ===');
            addLog('differences', 'ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:');
            addLog('differences', '// ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã‚’éè¡¨ç¤º');
            addLog('differences', 'document.querySelectorAll(".page-content").forEach(p => p.style.display = "none")');
            addLog('differences', '// bulkPageã‚’å¼·åˆ¶è¡¨ç¤º');
            addLog('differences', 'document.getElementById("bulkPage").style.display = "block"');
            addLog('differences', '// URLå…¥åŠ›æ¬„ã‚’å¼·åˆ¶è¡¨ç¤º');
            addLog('differences', 'document.getElementById("urlInput").style.cssText = "display: block !important; position: fixed !important; top: 100px !important; left: 100px !important; z-index: 99999 !important; background: yellow !important; border: 5px solid red !important; width: 400px !important; height: 200px !important;"');
        }

        function checkMainAppDifferences() {
            addLog('differences', '=== ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã¨ã®é•ã„ãƒã‚§ãƒƒã‚¯ ===');
            addLog('differences', '1. ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚’é–‹ã„ã¦ãã ã•ã„: http://localhost:8000');
            addLog('differences', '2. F12ã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ã„ã¦ãã ã•ã„');
            addLog('differences', '3. ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’é †ç•ªã«å®Ÿè¡Œã—ã¦çµæœã‚’å ±å‘Šã—ã¦ãã ã•ã„:');
            addLog('differences', '');
            addLog('differences', 'console.log("Page loaded:", document.readyState)');
            addLog('differences', 'console.log("BulkPage exists:", !!document.getElementById("bulkPage"))');
            addLog('differences', 'console.log("UrlInput exists:", !!document.getElementById("urlInput"))');
            addLog('differences', 'console.log("SwitchPageManual exists:", typeof switchPageManual)');
            addLog('differences', 'console.log("Script.js loaded:", typeof switchPage)');
            addLog('differences', '');
            addLog('differences', '4. URLä¸€æ‹¬è¿½åŠ ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„');
            addLog('differences', '5. ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:');
            addLog('differences', 'const bulkPage = document.getElementById("bulkPage")');
            addLog('differences', 'const urlInput = document.getElementById("urlInput")');
            addLog('differences', 'console.log("BulkPage display:", getComputedStyle(bulkPage).display)');
            addLog('differences', 'console.log("UrlInput display:", getComputedStyle(urlInput).display)');
            addLog('differences', 'console.log("UrlInput rect:", urlInput.getBoundingClientRect())');
        }

        function startMonitoring() {
            if (monitoringInterval) return;
            
            addLog('monitoring', 'ç›£è¦–é–‹å§‹...');
            monitoringInterval = setInterval(() => {
                try {
                    addLog('monitoring', `æ™‚åˆ»: ${new Date().toLocaleTimeString()}`);
                    addLog('monitoring', `ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªURL: ${window.location.href}`);
                    
                    // localhost:8000ãŒé–‹ã„ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆé–“æ¥çš„ã«ï¼‰
                    fetch('http://localhost:8000')
                        .then(response => {
                            addLog('monitoring', `localhost:8000 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status}`);
                        })
                        .catch(e => {
                            addLog('monitoring', `localhost:8000 ã‚¨ãƒ©ãƒ¼: ${e.message}`);
                        });
                        
                } catch (e) {
                    addLog('monitoring', `ç›£è¦–ã‚¨ãƒ©ãƒ¼: ${e.message}`);
                }
            }, 5000);
        }

        function stopMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
                addLog('monitoring', 'ç›£è¦–åœæ­¢');
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('differences', 'ãƒ‡ãƒãƒƒã‚°ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            addLog('differences', 'ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã¨ã®é€šä¿¡ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã§ãã¾ã™');
        });
    </script>
</body>
</html>